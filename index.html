<script type="module">
  import { login, signup, watchAuth } from "./js/auth.js";
  import { $ } from "./js/ui.js";

  watchAuth(async (u)=>{
    if(!u) return;
    const { db, doc, getDoc } = await import("./js/db.js");
    const snap = await getDoc(doc(db,'users',u.uid));
    if(!snap.exists()) return;
    const role = snap.data().role;
    location.href = role === "admin" ? "admin.html" : "user.html";
  });

  $("#btn-login").onclick = async ()=>{
    try {
      await login($("#li-email").value.trim(), $("#li-pass").value);
    } catch(e){ show('li-error', e.message); }
  };

  $("#btn-signup").onclick = async ()=>{
    try {
      await signup({
        name: $("#su-name").value.trim(),
        email: $("#su-email").value.trim(),
        pass: $("#su-pass").value,
        code: $("#su-code").value.trim().toUpperCase()
      });
      location.href = "user.html";
    } catch(e){ show('su-error', e.message); }
  };

  function show(id,msg){ const el=document.getElementById(id); el.style.display='inline-block'; el.textContent=msg; }
</script>
